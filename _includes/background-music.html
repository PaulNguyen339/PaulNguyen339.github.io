<!-- Subtle Background Music Player -->
<div class="bg-music-player" id="bgMusicPlayer">
  <audio id="bgMusic" loop preload="metadata">
    <source src="/assets/audio/background-music.mp3" type="audio/mpeg">
    Your browser does not support background music.
  </audio>

  <button id="musicToggle" class="music-toggle" title="Toggle Background Music">
    <span class="music-icon">ðŸŽµ</span>
    <span class="music-status">Off</span>
  </button>
</div>

<style>
.bg-music-player {
  position: fixed;
  bottom: 30px;
  right: 30px;
  z-index: 9999;
}

.music-toggle {
  background: linear-gradient(135deg, #159957, #1a7f3d);
  border: none;
  border-radius: 25px;
  padding: 12px 20px;
  color: white;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 15px rgba(21, 153, 87, 0.3);
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.music-toggle:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(21, 153, 87, 0.4);
  background: linear-gradient(135deg, #1a7f3d, #159957);
}

.music-toggle:active {
  transform: translateY(0);
}

.music-icon {
  font-size: 16px;
  animation: pulse 2s infinite;
}

.music-toggle.playing .music-icon {
  animation: bounce 1s infinite;
}

.music-status {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
  40% { transform: translateY(-3px); }
  60% { transform: translateY(-1px); }
}

@media (max-width: 768px) {
  .bg-music-player {
    bottom: 20px;
    right: 20px;
  }

  .music-toggle {
    padding: 10px 16px;
    font-size: 13px;
  }

  .music-icon {
    font-size: 14px;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const audio = document.getElementById('bgMusic');
  const toggleBtn = document.getElementById('musicToggle');
  const statusSpan = document.querySelector('.music-status');

  // Set initial volume (30% - subtle background level)
  audio.volume = 0.3;

  // Debug: Log audio element
  console.log('Audio element:', audio);
  console.log('Audio source:', audio.querySelector('source').src);

  // Check if user previously enabled music
  const musicEnabled = localStorage.getItem('bgMusicEnabled') === 'true';

  if (musicEnabled) {
    audio.play().then(() => {
      toggleBtn.classList.add('playing');
      statusSpan.textContent = 'On';
    }).catch((error) => {
      console.log('Autoplay failed:', error);
      statusSpan.textContent = 'Off';
    });
  }

  // Toggle music on/off
  toggleBtn.addEventListener('click', function() {
    if (audio.paused) {
      audio.play().then(() => {
        toggleBtn.classList.add('playing');
        statusSpan.textContent = 'On';
        localStorage.setItem('bgMusicEnabled', 'true');
        console.log('Music started successfully');
      }).catch((error) => {
        console.log('Play failed:', error);
        statusSpan.textContent = 'Click to enable';
      });
    } else {
      audio.pause();
      toggleBtn.classList.remove('playing');
      statusSpan.textContent = 'Off';
      localStorage.setItem('bgMusicEnabled', 'false');
      console.log('Music paused');
    }
  });

  // Handle audio errors gracefully
  audio.addEventListener('error', function(e) {
    console.log('Audio error:', e);
    console.log('Audio error details:', audio.error);
    console.log('Audio network state:', audio.networkState);
    console.log('Audio ready state:', audio.readyState);

    // Try to get more specific error info
    if (audio.error) {
      switch(audio.error.code) {
        case 1:
          console.log('MEDIA_ERR_ABORTED - Audio loading was aborted');
          break;
        case 2:
          console.log('MEDIA_ERR_NETWORK - Network error while loading audio');
          break;
        case 3:
          console.log('MEDIA_ERR_DECODE - Audio decoding error');
          break;
        case 4:
          console.log('MEDIA_ERR_SRC_NOT_SUPPORTED - Audio format not supported');
          break;
      }
    }

    // Hide the button if audio can't be loaded
    toggleBtn.style.display = 'none';
  });

  // Add load event listener
  audio.addEventListener('loadstart', function() {
    console.log('Audio loading started');
  });

  audio.addEventListener('canplay', function() {
    console.log('Audio can play');
  });

  audio.addEventListener('canplaythrough', function() {
    console.log('Audio can play through');
  });

  // Pause music when user leaves the page (optional)
  document.addEventListener('visibilitychange', function() {
    if (document.hidden && !audio.paused) {
      audio.pause();
    }
  });
});
</script>